---
import BaseLayout from '../layouts/BaseLayout.astro';
import EventCard from '../components/EventCard.astro';
import courses from '../data/courses.json';
import pricing from '../data/pricing.json';
import events from '../data/events.json';
import board from '../data/board.json';

// Get upcoming courses
const now = new Date();
const upcomingCourses = events.events
  .filter(event => event.type === 'corso' && new Date(event.date) >= now)
  .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
---

<BaseLayout title="Corsi di Vela" description="Corsi di vela FIV per giovani e adulti sul Lago Maggiore. Derive, cabinati, settimane intensive e weekend.">
  <!-- Hero -->
  <section class="relative bg-[var(--color-accent-primary)] pt-10 md:pt-14 pb-16 md:pb-20 overflow-hidden">
    <!-- Wave pattern -->
    <div class="absolute inset-0 pointer-events-none mix-blend-soft-light opacity-50" aria-hidden="true">
      <img src="images/wave-pattern.jpg" alt="" class="w-full h-full object-cover" />
    </div>
    <div class="relative max-w-6xl mx-auto px-4 lg:px-6">
      <div class="inline-block bg-[var(--color-accent-primary)] px-6 py-4 rounded-lg">
        <h1 class="text-3xl md:text-4xl font-black text-white" style="font-size: var(--text-3xl);">
          Corsi di Vela
        </h1>
      </div>
    </div>
    <!-- Wave Divider -->
    <div class="absolute bottom-0 left-0 right-0">
      <svg viewBox="0 0 1440 120" fill="none" preserveAspectRatio="none" class="w-full h-12 md:h-16">
        <path d="M0 120L60 110C120 100 240 80 360 70C480 60 600 60 720 65C840 70 960 80 1080 85C1200 90 1320 90 1380 90L1440 90V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z" fill="var(--color-bg-primary)" class="dark:fill-[var(--color-bg-primary-dark)]"/>
      </svg>
    </div>
  </section>

  <!-- Intro -->
  <section class="py-8 border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-6xl mx-auto px-4 lg:px-6">
      <p class="text-lg text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] max-w-3xl">
        Scuola vela FIV certificata per giovani e adulti. Impara a navigare sul Lago Maggiore con istruttori qualificati.
      </p>
    </div>
  </section>

  <!-- Course Types -->
  <section class="py-12 md:py-16">
    <div class="max-w-6xl mx-auto px-4 lg:px-6">
      <h2 class="text-2xl font-black mb-8" style="font-size: var(--text-2xl);">
        I Nostri Corsi
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {courses.courses.map((course) => (
          <article class="bg-[var(--color-bg-secondary)] dark:bg-[var(--color-bg-secondary-dark)] rounded-xl p-6 border border-gray-200 dark:border-gray-700">
            <div class="w-14 h-14 bg-[var(--color-accent-primary)] dark:bg-[var(--color-accent-primary-dark)] rounded-xl flex items-center justify-center mb-4">
              <span class="text-2xl">{course.icon === 'yacht' ? 'üõ•Ô∏è' : '‚õµ'}</span>
            </div>
            
            <h3 class="text-xl font-bold mb-1">{course.title}</h3>
            <p class="text-sm text-[var(--color-accent-primary)] dark:text-[var(--color-accent-primary-dark)] font-semibold mb-3">
              {course.subtitle}
            </p>
            
            <p class="text-sm text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] mb-4">
              {course.description}
            </p>
            
            <ul class="text-sm space-y-2 mb-4">
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-[var(--color-accent-success)] dark:text-[var(--color-accent-success-dark)]" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                <span><strong>Durata:</strong> {course.duration}</span>
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-[var(--color-accent-success)] dark:text-[var(--color-accent-success-dark)]" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                <span><strong>Periodo:</strong> {course.period}</span>
              </li>
              <li class="flex items-center gap-2">
                <svg class="w-4 h-4 text-[var(--color-accent-success)] dark:text-[var(--color-accent-success-dark)]" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                <span><strong>Imbarcazione:</strong> {course.boatType}</span>
              </li>
            </ul>
            
            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
              <p class="text-2xl font-black text-[var(--color-accent-primary)] dark:text-[var(--color-accent-primary-dark)]">
                ‚Ç¨{course.price.toFixed(2)}
                <span class="text-xs font-normal text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)]">
                  {course.priceNote}
                </span>
              </p>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Upcoming Courses -->
  {upcomingCourses.length > 0 && (
    <section class="py-12 md:py-16 bg-[var(--color-bg-secondary)] dark:bg-[var(--color-bg-secondary-dark)]">
      <div class="max-w-6xl mx-auto px-4 lg:px-6">
        <h2 class="text-2xl font-black mb-8" style="font-size: var(--text-2xl);">
          Prossimi Corsi
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
          {upcomingCourses.map((event) => (
            <EventCard event={event} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Pricing -->
  <section id="quote" class="py-12 md:py-16">
    <div class="max-w-6xl mx-auto px-4 lg:px-6">
      <h2 class="text-2xl font-black mb-8" style="font-size: var(--text-2xl);">
        Quote e Tariffe
      </h2>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Course Fees -->
        <div class="bg-[var(--color-bg-secondary)] dark:bg-[var(--color-bg-secondary-dark)] rounded-xl p-6 border border-gray-200 dark:border-gray-700">
          <h3 class="font-bold text-lg mb-4">{pricing.courses.title}</h3>
          <ul class="space-y-3">
            {pricing.courses.items.map((item) => (
              <li class="flex justify-between items-start">
                <div>
                  <p class="font-medium">{item.name}</p>
                  {item.note && (
                    <p class="text-xs text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)]">{item.note}</p>
                  )}
                </div>
                <p class="font-bold text-[var(--color-accent-primary)] dark:text-[var(--color-accent-primary-dark)]">
                  ‚Ç¨{item.price.toFixed(2)}
                </p>
              </li>
            ))}
          </ul>
          {pricing.courses.discounts && (
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <p class="text-sm text-[var(--color-accent-success)] dark:text-[var(--color-accent-success-dark)] font-medium">
                üí° {pricing.courses.discounts[0].description}: {pricing.courses.discounts[0].discount}
              </p>
            </div>
          )}
        </div>
        
        <!-- FIV Card Fees -->
        <div class="bg-[var(--color-bg-secondary)] dark:bg-[var(--color-bg-secondary-dark)] rounded-xl p-6 border border-gray-200 dark:border-gray-700">
          <h3 class="font-bold text-lg mb-1">{pricing.fivCard.title}</h3>
          <p class="text-sm text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] mb-4">{pricing.fivCard.note}</p>
          <ul class="space-y-3">
            {pricing.fivCard.items.map((item) => (
              <li class="flex justify-between items-start">
                <div>
                  <p class="font-medium">{item.name}</p>
                  {item.note && (
                    <p class="text-xs text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)]">{item.note}</p>
                  )}
                </div>
                <p class="font-bold">‚Ç¨{item.price.toFixed(2)}</p>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Registration Form -->
  <section id="iscrizione" class="py-12 md:py-16 bg-[var(--color-bg-secondary)] dark:bg-[var(--color-bg-secondary-dark)]">
    <div class="max-w-4xl mx-auto px-4 lg:px-6">
      <h2 class="text-2xl font-black mb-4 text-center" style="font-size: var(--text-2xl);">
        Iscriviti ai Corsi
      </h2>
      <p class="text-center text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] mb-8">
        Compila il modulo per iscriverti a uno dei nostri corsi di vela.
      </p>
      
      <!-- Google Form Placeholder -->
      <div class="bg-[var(--color-bg-primary)] dark:bg-[var(--color-bg-primary-dark)] rounded-xl p-8 border border-gray-200 dark:border-gray-700 text-center">
        <div class="w-16 h-16 mx-auto mb-4 bg-[var(--color-accent-primary)]/10 dark:bg-[var(--color-accent-primary-dark)]/10 rounded-full flex items-center justify-center">
          <svg class="w-8 h-8 text-[var(--color-accent-primary)] dark:text-[var(--color-accent-primary-dark)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
        </div>
        <h3 class="font-bold text-lg mb-2">Modulo di Iscrizione</h3>
        <p class="text-sm text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] mb-6">
          Il modulo di iscrizione Google Form sar√† integrato qui.
        </p>
        <a
          href={`mailto:${board.contact.email}?subject=Richiesta iscrizione corso vela`}
          class="inline-flex items-center justify-center px-6 py-3 bg-[var(--color-accent-secondary)] dark:bg-[var(--color-accent-secondary-dark)] text-white font-bold uppercase tracking-wide rounded-lg hover:opacity-90 transition-opacity touch-target"
        >
          Contattaci per Iscriverti
        </a>
      </div>
      
      <!-- Bank Details -->
      <div class="mt-8 p-6 bg-[var(--color-bg-primary)] dark:bg-[var(--color-bg-primary-dark)] rounded-xl border border-gray-200 dark:border-gray-700">
        <h3 class="font-bold mb-4">Coordinate Bancarie per Bonifico</h3>
        <dl class="space-y-2 text-sm">
          <div class="flex flex-col sm:flex-row sm:gap-4">
            <dt class="font-medium text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] sm:w-32">Intestatario:</dt>
            <dd>{pricing.bankDetails.accountHolder}</dd>
          </div>
          <div class="flex flex-col sm:flex-row sm:gap-4">
            <dt class="font-medium text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] sm:w-32">Banca:</dt>
            <dd>{pricing.bankDetails.bankName} - {pricing.bankDetails.branch}</dd>
          </div>
          <div class="flex flex-col sm:flex-row sm:gap-4">
            <dt class="font-medium text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)] sm:w-32">IBAN:</dt>
            <dd class="font-mono text-sm break-all">{pricing.bankDetails.iban}</dd>
          </div>
        </dl>
      </div>
    </div>
  </section>

  <!-- Safeguarding Note -->
  <section class="py-8 md:py-12">
    <div class="max-w-4xl mx-auto px-4 lg:px-6">
      <a href="safeguarding" class="flex items-center gap-4 p-5 bg-[var(--color-accent-primary)]/5 dark:bg-[var(--color-accent-primary-dark)]/10 rounded-xl border border-[var(--color-accent-primary)]/20 dark:border-[var(--color-accent-primary-dark)]/20 hover:border-[var(--color-accent-primary)] dark:hover:border-[var(--color-accent-primary-dark)] transition-colors group">
        <div class="w-12 h-12 bg-[var(--color-accent-primary)] dark:bg-[var(--color-accent-primary-dark)] rounded-xl flex items-center justify-center flex-shrink-0">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <div class="flex-1">
          <p class="font-bold">Safeguarding - Tutela dei Minori</p>
          <p class="text-sm text-[var(--color-text-secondary)] dark:text-[var(--color-text-secondary-dark)]">
            Il CNC ha implementato un modello organizzativo a tutela dei minori come previsto dalla legge.
          </p>
        </div>
        <svg class="w-5 h-5 text-[var(--color-accent-primary)] dark:text-[var(--color-accent-primary-dark)] group-hover:translate-x-1 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </section>
</BaseLayout>

